<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, maximum-scale=1">

	<title>Homepage</title>
    {% load static %}
	<link rel="icon" href="{% static 'FormExample/knight/favicon.png' %}" type="image/png">
    <link rel="shortcut icon" href="{% static 'FormExample/knight/favicon.ico' %}" type="img/x-icon">

	<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,800italic,700italic,600italic,400italic,300italic,800,700,600' rel='stylesheet' type='text/css'>

    <link href="{% static 'FormExample/knight/css/darkbutton.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'FormExample/knight/css/readonlyinput.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'FormExample/knight/css/bootstrap.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'FormExample/knight/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css">
	<link href="{% static 'FormExample/knight/css/style.css' %}" rel="stylesheet" type="text/css">
	<link href="{% static 'FormExample/knight/css/font-awesome.css' %}" rel="stylesheet" type="text/css">
	<link href="{% static 'FormExample/knight/css/responsive.css' %}" rel="stylesheet" type="text/css">
	<link href="{% static 'FormExample/knight/css/animate.css' %}" rel="stylesheet" type="text/css">
	
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script type="text/javascript" src="{% static 'FormExample/knight/js/jquery.1.8.3.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'FormExample/knight/js/bootstrap.js' %}"></script>
	<script type="text/javascript" src="{% static 'FormExample/knight/js/jquery-scrolltofixed.js' %}"></script>
	<script type="text/javascript" src="{% static 'FormExample/knight/js/jquery.easing.1.3.js' %}"></script>
	<script type="text/javascript" src="{% static 'FormExample/knight/js/jquery.isotope.js' %}"></script>
	<script type="text/javascript" src="{% static 'FormExample/knight/js/wow.js' %}"></script>
	<script type="text/javascript" src="{% static 'FormExample/knight/js/classie.js' %}"></script>
    <script src="{% static 'FormExample/knight/contactform/contactform.js' %}"></script>
    

</head>

<body style="background-color: #000000;">
	<nav class="main-nav-outer" id="test">
		<!--main-nav-start-->
		<div class="container">
			<ul class="main-nav">
				<li><a href="#header">Home</a></li>
				<li><a href="#service">Services</a></li>
				<li><a href="#Portfolio">Portfolio</a></li>
				<li class="small-logo"><a href="#header"><img src="{% static 'FormExample/knight/img/small-logo.png' %}" alt=""></a></li>
				<li><a href="#client">Clients</a></li>
				<li><a href="#team">Team</a></li>
				<li><a href="#contact">Contact</a></li>
			</ul>
			<a class="res-nav_click" href="#"><i class="fa fa-bars"></i></a>
		</div>
	</nav>
    <!--main-nav-end-->

    <input class="form-control" id="numberinputbutton" type="number" value="0" style="display:none;">

    <section class="business-talking">
		<!--business-talking-start-->
		<div class="container">
			<h2>Create New Line Up</h2>
		</div>
	</section>
    <!--business-talking-end-->
	<div class="container">
		<section class="main-section contact" id="contact">
			<div class="row">
				<div class="col-lg-6 col-sm-7 wow fadeInLeft">
                    <nav class="navbar navbar-dark bg-dark">
                        <form class="form-inline">
                            <input class="form-control" type="search" placeholder="Search" aria-label="Search">
                            <button class="btn btn-outline-info" type="submit">Search</button>
                        </form>
                    </nav>
                    <table class="table table-dark">
                        <thead class="thead-light">
                            <tr>
                                <th>Sector</th>
                                <th>Name</th>
                                <th>PPS</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for datapoint in data %}
                            <tr id="row{{forloop.counter}}">
                                <th scope="row">{{datapoint.1}}</th>
                                <td>{{datapoint.2}}</td>
                                <td>{{datapoint.4}}</td>
                                <td id = "button">
                                    <a href="#" onclick="$('#add{{forloop.counter}}').click();" class="btn btn-success btn-lg">
                                        <span class="glyphicon glyphicon-plus"></span>
                                    </a>
                                    <button type='button' id="add{{forloop.counter}}" onclick="cloneRow(this.parentNode.parentNode.id)" style="display:none;"></button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
				</div>
				<div class="col-lg-6 col-sm-5 wow fadeInUp delay-05s">
                    <nav class="navbar navbar-dark bg-dark inline">
                        <section class="business-talking-funds">
                            <h4>Line Up</h2>
                        </section>
                        <section class="business-talking-funds">
                            <h4 id="remainingfunds">Remaining Funds:</h2>
                        </section>
                        <section class="business-talking-fundsnumber inline">
                            <h4 id="remainingfundsnumber">$1000</h2>
                        </section>
                    </nav>
                    <table class="table table-light">
                        <thead class="thead-dark">
                            <tr>
                                <th>Sector</th>
                                <th>Name</th>
                                <th>Shares</th>
                                <th>PPS</th>
                            </tr>
                        </thead>
                        <tbody id="tableToModify">
                        </tbody>
                    </table>
                    <a href="#" onclick="$('#submit').click();" class="btn btn-info btn-lg float-right">
                        <span class="glyphicon glyphicon-plus"></span>
                    </a>
                    <button type='button' id="submit" onclick="post('/h2hrequest/');" style="display:none;"></button>
				</div>
			</div>
		</section>
	</div>
	<footer class="footer">
		<div class="container">
			<div class="footer-logo"><a href="#"><img src="{% static 'FormExample/knight/img/footer-logo.png' %}" alt=""></a></div>
			<span class="copyright">&copy; Stockjockey</span>
			</div>
		</div>
	</footer>


	<script type="text/javascript">
		$(document).ready(function(e) {
			$('#test').scrollToFixed();
			$('.res-nav_click').click(function() {
				$('.main-nav').slideToggle();
				return false

			});

		});
	</script>

	<script>
		wow = new WOW({
			animateClass: 'animated',
			offset: 100
		});
		wow.init();
	</script>


	<script type="text/javascript">
		$(window).load(function() {

			$('.main-nav li a, .servicelink').bind('click', function(event) {
				var $anchor = $(this);

				$('html, body').stop().animate({
					scrollTop: $($anchor.attr('href')).offset().top - 102
				}, 1500, 'easeInOutExpo');
				/*
				if you don't want to use the easing effects:
				$('html, body').stop().animate({
					scrollTop: $($anchor.attr('href')).offset().top
				}, 1000);
				*/
				if ($(window).width() < 768) {
					$('.main-nav').hide();
				}
				event.preventDefault();
			});
		})
	</script>

    <script type="text/javascript">
        var checkFundsLeft = function () {
            var stocktable = document.getElementById("tableToModify");
            var funds = 0;
            for(var i = 0; i < stocktable.children.length; i++){
                if(stocktable.children.length > 0){
                    funds += stocktable.children[i].children[2].children[0].value * stocktable.children[i].children[3].innerHTML;
                }
            }
            var remainingfunds = document.getElementById("remainingfunds");
            remainingfunds.innerHTML = "Remaining Funds:";
            var remainingfunds = document.getElementById("remainingfundsnumber");
            
            remainingfunds.innerHTML = "$" + (10000-funds);
        };

        var cloneFuncCalls = 0;
        function cloneRow(rowid) {
            cloneFuncCalls++;
            var row = document.getElementById(rowid); // find row to copy
            var table = document.getElementById("tableToModify"); // find table to append to
            var clone = row.cloneNode(true); // copy children too
            var pps = clone.children[2];
            clone.children[3].remove();
            clone.children[2].remove();
            var numberinputappend = document.getElementById("numberinputbutton");
            var tdnode = document.createElement("td"); // Create a <li> node
            var inputnode = document.createElement("input"); // Create a text node
            inputnode.setAttribute("class", "form-control");
            inputnode.setAttribute("type", "number");
            inputnode.setAttribute("id", "numberinput" + cloneFuncCalls);
            inputnode.setAttribute("value", "0");
            tdnode.appendChild(inputnode);
            clone.appendChild(tdnode);
            clone.setAttribute("id", "");
            clone.appendChild(pps);
            table.appendChild(clone); // add new row to end of table
            $("input[type=number]").bind('keyup input', function(){
                checkFundsLeft();
            });
        }

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                         break;
                    }
                }
            }
            return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');

            function csrfSafeMethod(method) {
                // these HTTP methods do not require CSRF protection
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }
            $.ajaxSetup({
                beforeSend: function (xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });

        function post(path) {
            var data = [];
            var stocktable = document.getElementById("tableToModify");
            var entry;
            for(var i = 0; i < stocktable.children.length; i++){
                if(stocktable.children.length > 0){
                    entry = {
                        "sector":   stocktable.children[i].children[0].innerHTML,
                        "name":     stocktable.children[i].children[1].innerHTML,
                        "shares":   stocktable.children[i].children[2].children[0].value,
                        "pps":      stocktable.children[i].children[3].innerHTML
                    };
                    data.push(entry);
                }
            }

            $.ajax({
                type: "POST",
                url: path,
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                error: function () {
                    alert("Error");
                },
                success: function () {
                    alert("OK");
                }
            });
        }

        

        
		$(window).load(function() {


			var $container = $('.portfolioContainer'),
				$body = $('body'),
				colW = 375,
				columns = null;


			$container.isotope({
				// disable window resizing
				resizable: true,
				masonry: {
					columnWidth: colW
				}
			});

			$(window).smartresize(function() {
				// check if columns has changed
				var currentColumns = Math.floor(($body.width() - 30) / colW);
				if (currentColumns !== columns) {
					// set new column count
					columns = currentColumns;
					// apply width to container manually, then trigger relayout
					$container.width(columns * colW)
						.isotope('reLayout');
				}

			}).smartresize(); // trigger resize to set container width
			$('.portfolioFilter a').click(function() {
				$('.portfolioFilter .current').removeClass('current');
				$(this).addClass('current');

				var selector = $(this).attr('data-filter');
				$container.isotope({

					filter: selector,
				});
				return false;
			});

		});
	</script>

</body>

</html>
